<p-table
  #dt
  [value]="metersPartialList()"
  [tableStyle]="{ 'min-width': '50rem' }"
  [lazy]="true"
  (onLazyLoad)="lazyLoadMeters($event)"
  [rows]="paginationMetersInfo.limit"
  [totalRecords]="paginationMetersInfo.total"
  [first]="(paginationMetersInfo.page - 1) * paginationMetersInfo.limit"
  [showCurrentPageReport]="true"
  [currentPageReportTemplate]="currentPageReportTemplate"
  [paginator]="paginationMetersInfo.total_pages > 1"
>
  <ng-template pTemplate="caption">
    <div class="flex justify-between">
      <p-button
        [outlined]="true"
        icon="pi pi-filter-slash"
        label="{{ 'MEMBER.VIEW.METERS.CLEAR_FILTER_BUTTON_LABEL' | translate }}"
        (onClick)="clear(dt)"
      ></p-button>
    </div>
  </ng-template>
  <ng-template pTemplate="header">
    <tr>
      <th>
        <div class="flex items-center">
          {{ 'MEMBER.VIEW.METERS.ADDRESS_LABEL' | translate }}
          <br />
          <p-columnFilter
            field="address"
            display="{{ 'MEMBER.VIEW.METERS.ADDRESS_LABEL' | translate }}"
            [showMatchModes]="false"
            [showOperator]="false"
            [showAddButton]="false"
            [showClearButton]="false"
          >
            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
              <div class="p-grid">
                <div class="p-col">
                  <label for="streetName" class="text-sm">{{
                    'MEMBER.VIEW.METERS.ADDRESS.STREET_NAME_LABEL' | translate
                  }}</label>
                  <input
                    pInputText
                    id="streetName"
                    [(ngModel)]="addressFilter.streetName"
                    placeholder="{{
                      'MEMBER.VIEW.METERS.ADDRESS.PLACEHOLDER.STREET_NAME_LABEL' | translate
                    }}"
                  />
                </div>
                <div class="p-col">
                  <label for="postcode" class="text-sm">{{
                    'MEMBER.VIEW.METERS.ADDRESS.POSTAL_CODE_LABEL' | translate
                  }}</label>
                  <input
                    pInputText
                    id="postcode"
                    [(ngModel)]="addressFilter.postcode"
                    placeholder="{{
                      'MEMBER.VIEW.METERS.ADDRESS.PLACEHOLDER.POSTAL_CODE_LABEL' | translate
                    }}"
                  />
                </div>
                <div class="p-col">
                  <label for="city" class="text-sm">{{
                    'MEMBER.VIEW.METERS.ADDRESS.CITY_LABEL' | translate
                  }}</label>
                  <input
                    pInputText
                    id="city"
                    [(ngModel)]="addressFilter.cityName"
                    placeholder="{{
                      'MEMBER.VIEW.METERS.ADDRESS.PLACEHOLDER.CITY_LABEL' | translate
                    }}"
                  />
                </div>
              </div>
            </ng-template>
          </p-columnFilter>
        </div>
      </th>
      <th>
        <div class="flex items-center text-base px-3">
          {{ 'MEMBER.VIEW.METERS.EAN_LABEL' | translate }} <br />
          <p-columnFilter
            type="text"
            field="EAN"
            display="{{ 'MEMBER.VIEW.METERS.EAN_LABEL' | translate }}"
            [showMatchModes]="false"
            [showOperator]="false"
            [showAddButton]="false"
          ></p-columnFilter>
        </div>
      </th>
      <th>
        <div class="flex items-center text-base px-3">
          {{ 'MEMBER.VIEW.METERS.METER_NUMBER_LABEL' | translate }} <br />
          <p-columnFilter
            type="text"
            field="meter_number"
            display="{{ 'MEMBER.VIEW.METERS.METER_NUMBER_LABEL' | translate }}"
            [showMatchModes]="false"
            [showOperator]="false"
            [showAddButton]="false"
          ></p-columnFilter>
        </div>
      </th>
      <th>
        <div class="flex items-center text-base px-3">
          {{ 'MEMBER.VIEW.METERS.STATUS_LABEL' | translate }}
          <p-columnFilter
            field="statut"
            display="menu"
            [showMatchModes]="false"
            [showOperator]="false"
            [showAddButton]="false"
          >
            <ng-template pTemplate="header">
              <span class="text-sm">{{
                'MEMBER.VIEW.METERS.FILTER_BY_STATUS_LABEL' | translate
              }}</span>
            </ng-template>
            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
              <p-select
                [ngModel]="value"
                [options]="statutCategory"
                (onChange)="filter($event.value)"
                placeholder="{{ 'MEMBER.VIEW.METERS.SELECT_A_STATUS_PLACEHOLDER' | translate }}"
                [showClear]="true"
              >
                <ng-template let-option pTemplate="item">
                  @switch (option.value) {
                    @case (MeterDataStatus.ACTIVE) {
                      <p-tag
                        class="text-sm"
                        severity="success"
                        value="{{ 'METER.STATUS.ACTIVE_LABEL' | translate }}"
                      ></p-tag>
                    }
                    @case (MeterDataStatus.INACTIVE) {
                      <p-tag
                        class="text-sm"
                        severity="danger"
                        value="{{ 'METER.STATUS.INACTIVE_LABEL' | translate }}"
                      ></p-tag>
                    }
                    @case (MeterDataStatus.WAITING_GRD) {
                      <p-tag
                        class="text-sm"
                        severity="danger"
                        value="{{ 'METER.STATUS.WAITING_GRD_LABEL' | translate }}"
                      ></p-tag>
                    }
                    @case (MeterDataStatus.WAITING_MANAGER) {
                      <p-tag
                        class="text-sm"
                        severity="danger"
                        value="{{ 'METER.STATUS.WAITING_MANAGER_LABEL' | translate }}"
                      ></p-tag>
                    }
                  }
                </ng-template>
                <ng-template pTemplate="selectedItem">
                  @switch (value) {
                    @case (MeterDataStatus.ACTIVE) {
                      <p-tag
                        class="text-sm"
                        severity="success"
                        value="{{ 'METER.STATUS.ACTIVE_LABEL' | translate }}"
                      ></p-tag>
                    }
                    @case (MeterDataStatus.INACTIVE) {
                      <p-tag
                        class="text-sm"
                        severity="danger"
                        value="{{ 'METER.STATUS.INACTIVE_LABEL' | translate }}"
                      ></p-tag>
                    }
                    @case (MeterDataStatus.WAITING_GRD) {
                      <p-tag
                        class="text-sm"
                        severity="danger"
                        value="{{ 'METER.STATUS.WAITING_GRD_LABEL' | translate }}"
                      ></p-tag>
                    }
                    @case (MeterDataStatus.WAITING_MANAGER) {
                      <p-tag
                        class="text-sm"
                        severity="danger"
                        value="{{ 'METER.STATUS.WAITING_MANAGER_LABEL' | translate }}"
                      ></p-tag>
                    }
                  }
                </ng-template>
              </p-select>
            </ng-template>
          </p-columnFilter>
        </div>
      </th>
      <th>
        <div class="flex items-center text-base px-3">
          {{ 'MEMBER.VIEW.METERS.SHARING_OPERATION_TITLE' | translate }} <br />
          <p-columnFilter
            field="sharingOperation"
            display="menu"
            [showMatchModes]="false"
            [showOperator]="false"
            [showAddButton]="false"
          >
            <ng-template pTemplate="header">
              <span class="text-sm">{{
                'MEMBER.VIEW.METERS.FILTER_BY_SHARING_OPERATION_LABEL' | translate
              }}</span>
            </ng-template>
            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
              <p-select
                [ngModel]="value"
                [options]="sharingOperations"
                (onChange)="filter($event.value)"
                placeholder="{{
                  'MEMBER.VIEW.METERS.SELECT_A_SHARING_OPERATION_PLACEHOLDER' | translate
                }}"
                [showClear]="true"
              >
                <ng-template let-option pTemplate="item">
                  <span class="text-sm">{{ option.name }}</span>
                </ng-template>
                <ng-template pTemplate="selectedItem">
                  <span class="text-sm">{{ value.name }}</span>
                </ng-template>
              </p-select>
            </ng-template>
          </p-columnFilter>
        </div>
      </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-meter>
    <tr (click)="onRowClick(meter)" style="cursor: pointer" class="hover-flex flex-wrap -mx-2">
      <td [innerHTML]="meter.address | address" class="text-sm"></td>
      <td class="text-sm px-3 py-2">{{ meter.EAN }}</td>
      <td class="text-sm px-3 py-2">{{ meter.meter_number }}</td>
      <td>
        @switch (meter.status) {
          @case (MeterDataStatus.ACTIVE) {
            <p-tag
              severity="success"
              value="{{ 'METER.STATUS.ACTIVE_LABEL' | translate }}"
              class="text-sm"
            ></p-tag>
          }
          @case (MeterDataStatus.INACTIVE) {
            <p-tag
              severity="danger"
              value="{{ 'METER.STATUS.INACTIVE_LABEL' | translate }}"
              class="text-sm"
            ></p-tag>
          }
          @case (MeterDataStatus.WAITING_GRD) {
            <p-tag
              severity="danger"
              value="{{ 'METER.STATUS.WAITING_GRD_LABEL' | translate }}"
              class="text-sm"
            ></p-tag>
          }
          @case (MeterDataStatus.WAITING_MANAGER) {
            <p-tag
              severity="danger"
              value="{{ 'METER.STATUS.WAITING_MANAGER_LABEL' | translate }}"
              class="text-sm"
            ></p-tag>
          }
        }
      </td>
      <td>
        @if (meter.sharingOperation) {
          <span class="text-sm px-3 py-2">{{ meter.sharingOperation.name }}</span>
        } @else {
          <span class="text-sm px-3 py-2"> / </span>
        }
      </td>
    </tr>
  </ng-template>
  <ng-template #emptyMessage pTemplate="emptymessage">
    <tr>
      <td colspan="6" class="text-base">
        {{ 'MEMBER.VIEW.METERS.NO_METER_FOUND_LABEL' | translate }}
      </td>
    </tr>
  </ng-template>
</p-table>
<div class="w-full">
  <p-button
    pRipple
    type="button"
    label="{{ 'MEMBER.VIEW.METERS.ADD_METER_BUTTON_LABEL' | translate }}"
    (click)="toAddMeter()"
  ></p-button>
</div>
